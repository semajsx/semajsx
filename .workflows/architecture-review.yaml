# Architecture Review Working Group - Introspection Workflow
#
# This workflow provides project introspection and diagnostics.
# It reviews the project's current state, identifies issues, technical debt, and improvement opportunities.
#
# Agents:
#   - @deepseek: Pattern scanner - quick scan for anti-patterns
#   - @cursor: Implementation analyst - deep code quality analysis
#   - @minimax-claude: Architecture reviewer - design coherence evaluation
#
# Usage:
#   agent-worker run .workflows/architecture-review.yaml
#   agent-worker run .workflows/architecture-review.yaml --tag <area>
#
# Examples:
#   agent-worker run .workflows/architecture-review.yaml --tag style-system
#   agent-worker run .workflows/architecture-review.yaml --tag performance
#   agent-worker run .workflows/architecture-review.yaml --tag testing

name: Architecture Review

agents:
  # DeepSeek: Pattern scanner
  # Good at: Quick scans, anti-patterns, inconsistencies
  deepseek:
    model: deepseek:deepseek-chat
    backend: sdk
    system_prompt: |
      You are DeepSeek, a fast-reasoning AI assistant specializing in pattern recognition.
      Your strengths:
      - Quick comprehension of project structure
      - Spotting anti-patterns and inconsistencies
      - Identifying obvious issues early

      You speak concisely. Focus on:
      1. Overall project structure health
      2. Obvious problems or missing pieces
      3. What might cause issues later

  # Cursor: Implementation analyst
  # Good at: Deep code analysis, edge cases, quality
  cursor:
    model: composer-1
    backend: cursor
    system_prompt: |
      You are Cursor Composer, an implementation-focused AI assistant.
      Your strengths:
      - Deep code analysis and edge case hunting
      - Testing strategy evaluation
      - API design review
      - Performance considerations

      You think carefully about code quality. Focus on:
      1. What edge cases are missing?
      2. How well is the code tested?
      3. Is the API ergonomic?
      4. Any performance concerns?

  # MiniMax Claude: Architecture reviewer
  # Good at: Design principles, long-term coherence
  minimax-claude:
    backend: claude
    system_prompt: |
      You are Claude (via MiniMax), a high-level architect focused on system design.
      Your strengths:
      - Design principles and coherence
      - Long-term maintainability
      - Trade-off analysis
      - Technical debt assessment

      You think about the big picture. Focus on:
      1. Is the project heading in the right direction?
      2. What are the long-term implications?
      3. What trade-offs have been made?
      4. What's the technical debt situation?

context:
  provider: file
  config:
    bind: .workflow/architecture-review/

setup:
  - shell: echo "$TAG"
    as: focus_area

  - shell: |
      if [[ -n "$TAG" ]]; then
        echo "Focus area: $TAG"
      else
        echo "Full project diagnostics"
      fi
    as: context_info

  - shell: ls -la
    as: project_structure

kickoff: |
  # Architecture Review - Project Introspection

  **Focus**: ${{ focus_area }}
  **Context**: ${{ context_info }}

  ---

  ## Project Structure
  ```
  ${{ project_structure }}
  ```

  ---

  ## Diagnostic Process

  ### Phase 1: Quick Scan (@deepseek)

  Scan the project for:
  - Directory structure anomalies
  - Missing files/configurations
  - Obvious anti-patterns
  - Dependency issues
  - Naming convention violations

  **Output**: Brief scan report in `#phase1`

  ---

  ### Phase 2: Deep Analysis (@cursor)

  Analyze code for:
  - Edge cases and error handling gaps
  - Type safety issues
  - Performance concerns
  - Testing coverage
  - API design quality

  **Output**: Detailed analysis in `#phase2`

  ---

  ### Phase 3: Architecture Review (@minimax-claude)

  Evaluate:
  - Design coherence with project goals
  - Trade-offs made
  - Long-term maintainability
  - Technical debt assessment
  - Missing considerations

  **Output**: Architectural assessment in `#phase3`

  ---

  ### Phase 4: Synthesis (@deepseek)

  Synthesize findings into:
  - Prioritized issue list
  - Actionable recommendations
  - Risk assessment
  - Overall project health score

  **Output**: Final diagnostic report in `#summary`

  ---

  ## Instructions

  **@deepseek**: Start with a broad quick scan. What's the overall project structure? Any obvious issues?

  **@cursor**: After quick scan, dive deep into code quality. What problems can you find?

  **@minimax-claude**: Provide architectural context. Is the project heading in the right direction?

  **@deepseek**: Synthesize all findings into a diagnostic report. What's the verdict?

  Reply in the channel. Use `@agentname` to address specific agents.
